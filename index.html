<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏¥‡∏Å‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</title>

  <!-- Google Fonts -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <style>
    * { font-family: "Kanit"; }
    body { background: #dab9e6; }
    .text-blue { color: #bc8fd0; }
    .text-pink { color: #f13596; }
  </style>
</head>
<body>
  <div class="container my-4">
    <div class="p-4 mb-4 bg-white rounded shadow-sm text-center">
      <h1 class="display-6 fw-bold text-blue">‡πÅ‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</h1>
      <h2 class="display-6 fw-bold text-pink">‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î<span class="h3 fw-bold text-dark">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡πÑ‡∏ó‡∏¢‡∏õ‡∏•‡∏≠‡∏î </span><span class="h3 fw-bold text-danger">‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</span></h2>
      <p class="text-muted">‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏°‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π<br>‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ñ‡∏•‡∏≤‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï</p>
    </div>

    <!-- Loader -->
    <div id="loading" class="text-center p-4">
      <div class="spinner-border text-primary" role="status"></div>
      <p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>
    
    <!-- Form -->
    <form id="followupForm" class="row g-3 bg-white p-4 rounded shadow-sm d-none" autocomplete="off">

      <input type="hidden" id="userId">
      <div class="col-md-6">
        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input type="text" class="form-control" id="firstName" readonly>
      </div>

      <div class="col-md-6">
        <label class="form-label">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" class="form-control" id="lastName" readonly>
      </div>

      <!-- Smoking history -->
      <h5 class="fw-bold">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•)</h5>

      <div class="col-md-6">
        <label class="form-label">‡∏™‡∏π‡∏ö‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Å‡∏µ‡πà‡∏°‡∏ß‡∏ô</label>
        <input type="number" class="form-control" id="cigarettesPerDay" min="0" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">‡∏™‡∏π‡∏ö‡∏°‡∏≤‡∏Å‡∏µ‡πà‡∏õ‡∏µ</label>
        <input type="number" class="form-control" id="smokingYears" min="0" required>
      </div>
      <div class="col-md-6">
        <label class="form-label">‡∏Å‡∏µ‡πà‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
        <input type="number" class="form-control" id="smokingMonths" min="0" max="11" required>
      </div>

      <div class="col-md-6">
        <label class="form-label">‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏µ‡πà‡∏Ñ‡∏£‡∏±‡πâ‡∏á</label>
        <input type="number" class="form-control" id="quitAttempts" min="0" required>
      </div>

      <div class="col-md-12 mt-4">
        <label class="form-label fw-bold">‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
        <select class="form-select" id="wantToQuit" required>
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
          <option value="‡∏≠‡∏¢‡∏≤‡∏Å">‡∏≠‡∏¢‡∏≤‡∏Å</option>
          <option value="‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å">‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å</option>
          <option value="‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à">‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à</option>
        </select>
      </div>

      <!-- ‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á -->
      <div id="dependenceAssessment" class="mt-4 d-none">
        <h5 class="fw-bold">‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà</h5>

        <div class="col-md-12">
          <label class="form-label">1. ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏°‡∏ß‡∏ô‡πÅ‡∏£‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏´‡∏£‡πà</label>
          <select class="form-select" id="q1">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô</option>
            <option>6 - 30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô</option>
            <option>31 - 60 ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô</option>
            <option>60 ‡∏ô‡∏≤‡∏ó‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô</option>
          </select>
        </div>

        <div class="col-md-12 mt-2">
          <label class="form-label">2. ‡∏Ñ‡∏∏‡∏ì‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡∏≠‡∏∂‡∏î‡∏≠‡∏±‡∏î‡πÉ‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Ç‡∏ï‡∏õ‡∏•‡∏≠‡∏î‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
          <select class="form-select" id="q2">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡πÉ‡∏ä‡πà</option>
            <option>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option>
          </select>
        </div>

        <div class="col-md-12 mt-2">
          <label class="form-label">3. ‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏°‡∏ß‡∏ô‡πÑ‡∏´‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</label>
          <select class="form-select" id="q3">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡∏°‡∏ß‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô</option>
            <option>‡∏°‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
          </select>
        </div>

        <div class="col-md-12 mt-2">
          <label class="form-label">4. ‡πÇ‡∏î‡∏¢‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏ß‡∏±‡∏ô‡∏•‡∏∞‡∏Å‡∏µ‡πà‡∏°‡∏ß‡∏ô</label>
          <select class="form-select" id="q4">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 10 ‡∏°‡∏ß‡∏ô</option>
            <option>11 - 20 ‡∏°‡∏ß‡∏ô</option>
            <option>21 - 30 ‡∏°‡∏ß‡∏ô</option>
            <option>‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏°‡∏ß‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ</option>
          </select>
        </div>

        <div class="col-md-12 mt-2">
          <label class="form-label">5. ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 2-3 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∑‡πà‡∏ô‡∏ô‡∏≠‡∏ô ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
          <select class="form-select" id="q5">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡πÉ‡∏ä‡πà</option>
            <option>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option>
          </select>
        </div>

        <div class="col-md-12 mt-2">
          <label class="form-label">6. ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡πÅ‡∏°‡πâ‡∏à‡∏∞‡∏ô‡∏≠‡∏ô‡∏õ‡πà‡∏ß‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà</label>
          <select class="form-select" id="q6">
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</option>
            <option>‡πÉ‡∏ä‡πà</option>
            <option>‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà</option>
          </select>
        </div>
      </div>

      <div class="col-12 text-center mt-4">
        <button type="button" id="submitBtn" class="btn btn-lg btn-primary">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</button>
      </div>
    </form>

    <!-- Success -->
    <div id="successMessage" class="d-none text-center p-4 bg-white rounded shadow-sm mt-4">
      <h3 class="text-success fw-bold">‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</h3>
      <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏ú‡∏•</p>
    </div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    let userId = "";

    async function initLiff() {
      try {
        await liff.init({ liffId: "2007904397-o7eP51Zq" });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        userId = profile.userId;
        document.getElementById("userId").value = userId;

        // üîé ‡πÑ‡∏õ‡∏Ñ‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•‡∏à‡∏≤‡∏Å Google Sheet
        fetch("https://script.google.com/macros/s/AKfycbxKvwoVTft5-_xGjM3czNhWqUJ7X-Z-yLSV_z3j8NGjlO2x1mDSlXzkpCunaUHH5YFpdw/exec?userId=" + userId)
          .then(res => res.json())
          .then(data => {
            if (data.status === "success") {
              document.getElementById("firstName").value = data.firstName;
              document.getElementById("lastName").value = data.lastName;
              // ‚úÖ ‡∏ã‡πà‡∏≠‡∏ô loading ‡πÅ‡∏•‡∏∞‡πÇ‡∏ä‡∏ß‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
              document.getElementById("loading").classList.add("d-none");
              document.getElementById("followupForm").classList.remove("d-none");
            } else {
              alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ");
            }
          })
          .catch(err => console.error(err));
      } catch (err) {
        console.error("LIFF init error", err);
      }
    }

    document.addEventListener("DOMContentLoaded", initLiff);
  </script>

  <script>
    // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô
    document.getElementById("wantToQuit").addEventListener("change", function() {
      const assessment = document.getElementById("dependenceAssessment");
      if (this.value === "‡∏≠‡∏¢‡∏≤‡∏Å" || this.value === "‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à") {
        assessment.classList.remove("d-none");
      } else {
        assessment.classList.add("d-none");
      }
    });

    // Submit form
    $("#submitBtn").on("click", function() {
      console.log('userId:', userId);
      const data = {
        userId: $("#userId").val(),
        timestamp: new Date().toLocaleString('th-TH', { timeZone: 'Asia/Bangkok' }),
        firstName: $("#firstName").val(),
        lastName: $("#lastName").val(),
        cigarettesPerDay: $("#cigarettesPerDay").val(),
        smokingYears: $("#smokingYears").val(),
        smokingMonths: $("#smokingMonths").val(),
        quitAttempts: $("#quitAttempts").val(),
        wantToQuit: $("#wantToQuit").val(),
        q1: $("#q1").val(),
        q2: $("#q2").val(),
        q3: $("#q3").val(),
        q4: $("#q4").val(),
        q5: $("#q5").val(),
        q6: $("#q6").val(),
      };

      fetch("https://script.google.com/macros/s/AKfycbyrjDTmU-LQPqt2iJhQGLyCE7uHw1CieXsEkuJCob0Zw6hUoB4UZ3i7MOSsMZ3VAt6W/exec", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      })
      .then(async res => {
        const text = await res.text();
        console.log("Raw response:", text);
        return JSON.parse(text);
      })
      .then(res => {
        console.log("Parsed JSON:", res);
        if (res.status === 'success') {
          document.getElementById("followupForm").classList.add("d-none");
          document.getElementById("successMessage").classList.remove("d-none");
        } else {
          alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + res.message);
        }
      })
      .catch(err => alert("Error: " + err.message));
    }); // ‚úÖ ‡∏õ‡∏¥‡∏î‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
  </script>
</body>
</html>

